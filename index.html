<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercice Test - Connexion Firebase</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f4f9; display: flex; justify-content: center; padding-top: 50px; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 500px; }
        h1 { color: #333; text-align: center; }
        .question { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        label { display: block; margin-bottom: 8px; cursor: pointer; }
        input[type="text"] { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 5px; }
        button { width: 100%; padding: 15px; background-color: #ff6f00; color: white; border: none; font-size: 16px; border-radius: 5px; cursor: pointer; transition: 0.3s; }
        button:hover { background-color: #e65100; }
        #message { margin-top: 15px; text-align: center; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>üìù Devoir Test PSE</h1>
    <p>Remplissez ce formulaire pour tester l'envoi vers Firebase.</p>

    <div id="monFormulaire">
        <div class="question">
            <strong>Votre Nom :</strong>
            <input type="text" id="nomEleve" placeholder="Ex: Jean Dupont">
        </div>

        <div class="question">
            <strong>Q1. Quelle est la capitale de la France ?</strong><br>
            <label><input type="radio" name="q1" value="Lyon"> Lyon</label>
            <label><input type="radio" name="q1" value="Paris"> Paris</label>
            <label><input type="radio" name="q1" value="Marseille"> Marseille</label>
        </div>

        <div class="question">
            <strong>Q2. Combien font 2 + 2 ?</strong><br>
            <label><input type="radio" name="q2" value="3"> 3</label>
            <label><input type="radio" name="q2" value="4"> 4</label>
            <label><input type="radio" name="q2" value="5"> 5</label>
        </div>

        <button id="btnEnvoyer">Envoyer ma copie üöÄ</button>
    </div>

    <div id="message"></div>
</div>

<script type="module">
  // Importation des fonctions n√©cessaires depuis Google
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

  // TA CONFIGURATION (Copi√©e depuis tes images)
  const firebaseConfig = {
    apiKey: "AIzaSyBfRcWCd5bMXSb7Gqr88Z5NpQAaG10pVqk",
    authDomain: "cours-pse.firebaseapp.com",
    projectId: "cours-pse",
    storageBucket: "cours-pse.firebasestorage.app",
    messagingSenderId: "441161657492",
    appId: "1:441161657492:web:6d71044306717b47121881",
    measurementId: "G-JFENRTHQH6"
  };

  // Initialisation
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Fonction d√©clench√©e au clic sur le bouton
  document.getElementById("btnEnvoyer").addEventListener("click", async () => {
    
    // 1. R√©cup√©ration des valeurs du formulaire
    const nom = document.getElementById("nomEleve").value;
    // On r√©cup√®re les boutons radio coch√©s
    const q1Element = document.querySelector('input[name="q1"]:checked');
    const q2Element = document.querySelector('input[name="q2"]:checked');

    // Petite v√©rification que tout est rempli
    if (!nom || !q1Element || !q2Element) {
        alert("Merci de remplir tout le questionnaire !");
        return;
    }

    const reponseQ1 = q1Element.value;
    const reponseQ2 = q2Element.value;
    const messageDiv = document.getElementById("message");
    const bouton = document.getElementById("btnEnvoyer");

    messageDiv.innerText = "Envoi en cours vers Firebase...";
    bouton.disabled = true; // On d√©sactive le bouton pour √©viter les double-clics

    try {
      // 2. ENVOI VERS FIREBASE
      // On cr√©e une collection "copies_test"
      const docRef = await addDoc(collection(db, "copies_test"), {
        eleve: nom,
        reponse_1: reponseQ1,
        reponse_2: reponseQ2,
        date_envoi: new Date().toLocaleString()
      });

      // 3. Succ√®s
      messageDiv.style.color = "green";
      messageDiv.innerText = "‚úÖ Bien re√ßu ! Copie enregistr√©e sur Firebase.";
      console.log("Document √©crit avec ID: ", docRef.id);

    } catch (e) {
      // 4. Erreur
      console.error("Erreur d'ajout : ", e);
      messageDiv.style.color = "red";
      messageDiv.innerText = "‚ùå Erreur : Regarde la console (F12) pour les d√©tails.";
      bouton.disabled = false;
    }
  });
</script>

</body>
</html>